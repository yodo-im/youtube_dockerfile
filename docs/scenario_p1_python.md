`` ``` ```
## Dockerfile. Часть 1
# Вступление и контейнер с простейшим python скриптом


1. Здравствуйте! С вами yodo.im и в этом уроке мы поговорим о докерфайлах, как с помощью них создавать свои образы и запускать на их основе контейнеры.
В ходе урока мы создадим, докиризируем и поднимем небольшое приложение на питон, которое будет проверять доступность сайтов, а список этих сайтов, точнее доменов, подгружать из базы данных mysql.

2. Сначала создадим заготовку для образа на основе которого будет запускаться приложение. Будем писать на языке python. Наша задача на данном этапе чтобы контейнер при запуске выводил в консоль текст. Для этого подготовим файл с простым скриптом `print("Hello from container!")`, положим его в образ и дадим команду его исполнить. И в этом нам подможет докерфайл! Докерфайл это специальноая инструкция для докер по которой он создаёт образ.

3. Итак, проделываем подготовительную работу. На своей локальной машине создаём директорию, в которой будет находится всё что нужно для нашего проекта, создаём виртуальное окружение, чтобы удобнее было работать с python локально,  директорию для файлов нашего приложения и сам тестовый скрипт.
```
virtualenv venv
pip install -U pip
mkdir ~/Desktop/check-domain
cd ~/Desktop/check-domain
echo 'print("Hello from container!") > test.py'
source venv/bin/activate
cd app
mkdir ./app
touch test.py
python test.py
```

4. На сайте http://hub.docker.com находим официальный образ python на основе которого будем создавать свой. В документации к этому образу как есть рекомендации как это лучше сделать используя Dockerfile.

5. Создаём в корневой директории нашего проекта файл `Dockerfile`

6. На страничке https://hub.docker.com/_/python находим раздел *Create a Dockerfile in your Python app project* и копируем первую часть, вставляем в только что созданный Dockerfile. Вносим небольшие изменения:

```
FROM python:3

WORKDIR /usr/src/app

COPY ./app .

CMD [ "python", "./test.py" ]
```
FROM - на основе какого образа делаем свой

WORKDIR - рабочая директория или директория по умолчанию в контейнере запущенном из данного образа, т.е это директория относительно которой формируются пути. Если такой директории нет в родительском контейнере она автоматически создаётся при создании образа. WORKDIR обозначается точкой `.` в пути к файлам. Например, если мы даём команду python test.py, файл test.py будет искаться в рабочей директории.

COPY даёт команду копирования файлов из локальной машины в образ.
Первый аргумент - путь откуда копировать на хосте (локальной машине), `.` - корневая директория где расположен докер файл, относительно неё указывается адрес. второй аргумент - путь куда копировать в образе, `.` - WORKDIR.

CMD - указывает какие действия должны быть совершены при запуске контейнера из этого образа. Разработчики докер рекомендуют писать их в виде массива ["консольное приложение","аргумент 1","аргумент 2"], приложение - это первый элемент, аргументов может быть сколько угодно, может и не быть (exec формат). Но так же не будет ошибкой, если записать просто в формате `python test.py` (shell формат).

7. Собираем образ. В консоли на рабочей машине заходим в корневую директорию нашего проекта и пишем команду для сборки образа `docker build -t cd_py_img1 .`

8. Запускаем контейнер `docker run cd_py_img1` и мы должны увидеть текст который мы писали в питон скрипте.

9. Процесс формирования образа можно посмотреть командой `docker history cd_py_img1`

10. Процесс запуска контейнера можно посмотреть командой  `docker log <container name>`

<!-- 11. Начинаем создавать приложение. Для того чтобы проверять доступность сайтов, нам нужно установить пакет `requests`. Создадим файл `requirements.txt` в корневой директории проекта, здесь будут прописаны зависимости. В этом файле пока что пропишем одно слово `requests`, название пакета. Затем обновим менеджер пакета pip и установим зависимости с помощью команды в bash, пока что только на хосте, при этом мы должны находиться в виртуальной среде. Это нужно чтобы проверить работу скриптов.

12. В директории на локальном хосте создаём файл `main.py`. Заходим в [официальную документацию requests](https://docs.python-requests.org/en/latest/user/quickstart/#make-a-request) и копируем один из примеров. Сначала попробуем проверить один жёсткой заданный домен, например yodo.im. И вносим ещё немного изменений.

```
import requests
from time import sleep

while True:
    domain = 'facebook.com'

    r = requests.get('https://'+domain)

    status = 'ok' if r.status_code == requests.codes.ok else 'fail'

    print(f'{domain} ......... {status}')

    sleep(2)
```

13. Собираем образ с рыбой приложения `docker build -t cd_py_img2 .` -->
